(this.webpackJsonpcarbon_copy=this.webpackJsonpcarbon_copy||[]).push([[0],{281:function(e,t,n){e.exports=n.p+"static/media/stick_figure_in_box.66cc93bc.png"},296:function(e,t,n){var a=n(572),r=["load","predict"];e.exports=function(){var e=new Worker(n.p+"e7c4556103d7ca32aea4.worker.js",{name:"[hash].worker.js"});return a(e,r),e}},308:function(e,t,n){e.exports=n(573)},313:function(e,t,n){},327:function(e,t){},329:function(e,t){},377:function(e,t){},379:function(e,t){},407:function(e,t){},409:function(e,t){},410:function(e,t){},416:function(e,t){},418:function(e,t){},436:function(e,t){},438:function(e,t){},450:function(e,t){},453:function(e,t){},458:function(e,t){},460:function(e,t){},483:function(e,t){},573:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(17),o=n.n(c);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(313);var i,l,s=n(3),u=n(271),d=n.n(u),p=n(619),m=n(298),f=n(618),b=n(297),v=n.n(b),g=n(576),h=n(4),O=n.n(h),j=n(11),y=Object(a.createContext)(),k=function(){var e=Object(a.useContext)(y);if(!e)throw new Error("useWebcam must be used within a WebcamProvider");return e},E=!!(null===(i=navigator)||void 0===i||null===(l=i.mediaDevices)||void 0===l?void 0:l.getUserMedia),C=function(e){var t,n,c,o,i=e.children,l=Object(a.useRef)(),u=Object(a.useRef)(),d=Object(a.useRef)(),p=Object(a.useState)(null),m=Object(s.a)(p,2),f=m[0],b=m[1],v=Object(a.useState)(!0),g=Object(s.a)(v,2),h=g[0],k=g[1],C=Object(a.useState)(!1),w=Object(s.a)(C,2),x=w[0],S=w[1],I=Object(a.useState)([]),T=Object(s.a)(I,2),L=T[0],M=T[1],R=Object(a.useState)(!0),A=Object(s.a)(R,2),P=A[0],D=A[1],N=Object(a.useState)(null),F=Object(s.a)(N,2),U=F[0],_=F[1],B=Object(a.useState)(null),z=Object(s.a)(B,2),G=z[0],Y=z[1],V=Object(a.useState)(null),W=Object(s.a)(V,2),q=W[0],H=W[1],X=Object(a.useState)(!1),K=Object(s.a)(X,2),$=K[0],Z=K[1],J=Object(a.useState)(!1),Q=Object(s.a)(J,2),ee=Q[0],te=Q[1],ne=Object(a.useState)(void 0),ae=Object(s.a)(ne,2),re=ae[0],ce=ae[1],oe=Object(a.useState)(void 0),ie=Object(s.a)(oe,2),le=ie[0],se=ie[1];Object(a.useEffect)((function(){d.current&&!f?b(d.current.getContext("2d")):f&&!d.current&&b(null)}),[f]),Object(a.useEffect)((function(){if(x&&!U){var e=document.createElement("canvas");e.width=d.current.width,e.height=d.current.height;var t=e.getContext("2d");_({ctx:t,canvas:e})}}),[U,x]);var ue=Object(a.useCallback)((function(){D(!1)}),[]),de=Object(a.useCallback)((function(){D(!0)}),[]),pe=Object(a.useCallback)((function(){U.ctx.clearRect(0,0,d.current.width,d.current.height)}),[U]),me=Object(a.useCallback)((function(){var e,t;f.clearRect(0,0,null===(e=d.current)||void 0===e?void 0:e.width,null===(t=d.current)||void 0===t?void 0:t.height)}),[f]),fe=Object(a.useCallback)((function(){q&&q.getTracks().forEach((function(e){return e.stop()})),Y(null),H(null),S(!1),ce(void 0)}),[q]),be=Object(a.useCallback)(function(){var e=Object(j.a)(O.a.mark((function e(t){var n,a,r,c,o,i,l,s,d,p,m,f,b;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe(),E){e.next=6;break}return"Video not supported",console.error("Video not supported"),Y("Video not supported"),e.abrupt("return");case 6:return a=(n="number"===typeof t)?{}:t||{},r=n?t:a.deviceIdx,e.prev=9,console.log("Finding Webcams..."),i={video:{width:{exact:a.width||1280},height:{exact:a.height||720}},audio:!1},void 0!==r&&(a.deviceId=null===(l=L[r])||void 0===l?void 0:l.deviceId),a.deviceId&&(i.video.deviceId={exact:a.deviceId}),e.next=16,navigator.mediaDevices.getUserMedia(i);case 16:s=e.sent,d=null===(c=s.getTracks()[0])||void 0===c||null===(o=c.getCapabilities())||void 0===o?void 0:o.deviceId,console.log("Found webcam!"),H(s),ce(d),Y(!1),te(!1),Z(!1),u.current.srcObject=s,e.next=37;break;case 27:return e.prev=27,e.t0=e.catch(9),"Error starting video.",console.error("Error starting video."),console.error(e.t0.message),(null===(p=e.t0.message)||void 0===p||null===(m=p.toLowerCase)||void 0===m||null===(f=m.call(p))||void 0===f||null===(b=f.includes)||void 0===b?void 0:b.call(f,"permission denied"))&&te(!0),H(null),S(!1),Y("Error starting video."),e.abrupt("return");case 37:return e.next=39,Promise.all([new Promise((function(e){u.current.onloadedmetadata=function(){return e()}})),new Promise((function(e){u.current.onloadeddata=function(){return e()}}))]).then((function(){console.log("Webcam ready!"),S(!0),D(!1)}));case 39:return e.abrupt("return",e.sent);case 40:case"end":return e.stop()}}),e,null,[[9,27]])})));return function(t){return e.apply(this,arguments)}}(),[fe,u,L]),ve=Object(a.useCallback)(Object(j.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",be({deviceId:le}));case 1:case"end":return e.stop()}}),e)}))),[le,be]),ge=Object(a.useCallback)(Object(j.a)(O.a.mark((function e(){var t,n,a,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=navigator)||void 0===t||null===(n=t.mediaDevices)||void 0===n?void 0:n.enumerateDevices){e.next=4;break}return console.error("Cannot get cameras."),e.abrupt("return",[]);case 4:return e.next=6,navigator.mediaDevices.enumerateDevices();case 6:return a=e.sent,r=a.filter((function(e){var t=e.kind,n=e.label;return"videoinput"===t&&!n.includes("CamTwist")})).map((function(e){var t,n=e.label.lastIndexOf(" (");return n>-1&&(t=e.label.slice(0,n)),t?{deviceId:e.deviceId,label:t}:e})),M(r),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)}))),[]),he=Object(a.useCallback)((function(){return k((function(e){return!e}))}),[]),Oe=Object(a.useCallback)((function(e){window.localStorage.setItem("AutoStartId",e),se(e)}),[]),je=Object(a.useCallback)((function(){window.localStorage.removeItem("AutoStartId"),se(null)}),[]),ye=Object(a.useCallback)((function(e){pe(),U.ctx.putImageData(e,0,0);var t=U.canvas.toDataURL("image/png");return pe(),t}),[U,pe]),ke=Object(a.useCallback)(function(){var e=Object(j.a)(O.a.mark((function e(t){var n,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("DATA URI: ",t),pe(),(n=new Image).src=t,e.next=6,new Promise((function(e){n.onload=function(){U.ctx.drawImage(n,0,0),e()}}));case 6:return a=U.ctx.getImageData(0,0,d.current.width,d.current.height),pe(),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[pe,U]),Ee=Object(a.useCallback)((function(){pe(),U.ctx.drawImage(u.current,0,0);var e=U.ctx.getImageData(0,0,d.current.width,d.current.height);return pe(),e}),[pe,U]);Object(a.useEffect)((function(){ge().then((function(e){var t,n=window.localStorage.getItem("AutoStartId"),a=!1,r=null===(t=e[0])||void 0===t?void 0:t.deviceId;(r=e.reduce((function(e,t,r){var c=t.deviceId,o=t.label;return c||(a=!0),c===n?c:e||(o.includes("Built-in")?c:null)}),null)||r)?Oe(r):a?(Z(!0),console.warn("Need video permissions!")):!r&&n&&je()}))}),[]);var Ce=!!((null===(t=l.current)||void 0===t?void 0:t.requestFullscreen)||(null===(n=l.current)||void 0===n?void 0:n.mozRequestFullScreen)||(null===(c=l.current)||void 0===c?void 0:c.webkitRequestFullscreen)||(null===(o=l.current)||void 0===o?void 0:o.msRequestFullscreen)),we=Object(a.useState)(!1),xe=Object(s.a)(we,2),Se=xe[0],Ie=xe[1];Object(a.useEffect)((function(){var e=function(){var e=!!document.fullscreenElement;Ie(e)};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]);var Te=Object(a.useCallback)((function(){Ce&&(l.current.requestFullscreen?l.current.requestFullscreen():l.current.mozRequestFullScreen?l.current.mozRequestFullScreen():l.current.webkitRequestFullscreen?l.current.webkitRequestFullscreen():l.current.msRequestFullscreen&&l.current.msRequestFullscreen())}),[Ce]),Le=Object(a.useCallback)((function(){Ce&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())}),[Ce]),Me=Object(a.useCallback)((function(){Se?Le():Te()}),[Se,Te,Le]),Re=Object(a.useMemo)((function(){return{ctx:f,ready:x,flipX:h,start:ve,hidden:P,rootRef:l,cameras:L,setFlipX:k,videoRef:u,hasVideo:E,_setHidden:de,canvasRef:d,stopVideo:fe,setVisible:ue,startVideo:be,videoError:G,scratchpad:U,clearCanvas:me,toggleFlipX:he,videoStream:q,hasFullScreen:Ce,exitFullScreen:Le,clearScratchpad:pe,currentDeviceId:re,enterFullScreen:Te,stop:fe,discoverCameras:ge,permissionNeeded:$,permissionDenied:ee,toggleFullScreen:Me,autoStartDeviceId:le,imageDataToDataUri:ye,dataUriToImageData:ke,getVideoAsImageData:Ee,setAutoStartDeviceId:Oe,clearAutoStartDeviceId:je,isFullScreen:Se}}),[f,x,h,ve,P,L,k,de,fe,Se,ue,be,G,U,he,me,q,Ce,Le,pe,re,Te,ge,$,ee,Me,le,ye,ke,Ee,Oe,je]);return r.a.createElement(y.Provider,{value:Re},i)},w=n(46),x=n(6),S=n(25),I=n(574),T=n(610),L=n(15),M=n(280),R=n.n(M),A=n(279),P=n.n(A),D=function(e){var t=e.color,n=void 0===t?"#fff":t,a=Object(L.c)({to:{opacity:1},from:{opacity:0},config:L.b.stiff});return r.a.createElement(L.a.div,{style:a},r.a.createElement("svg",{version:"1.1",id:"L7",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 100 100",enableBackground:"new 0 0 100 100"},r.a.createElement("path",{fill:n,d:"M31.6,3.5C5.9,13.6-6.6,42.7,3.5,68.4c10.1,25.7,39.2,38.3,64.9,28.1l-3.1-7.9c-21.3,8.4-45.4-2-53.8-23.3 c-8.4-21.3,2-45.4,23.3-53.8L31.6,3.5z"},r.a.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"2s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})),r.a.createElement("path",{fill:n,d:"M42.3,39.6c5.7-4.3,13.9-3.1,18.1,2.7c4.3,5.7,3.1,13.9-2.7,18.1l4.1,5.5c8.8-6.5,10.6-19,4.1-27.7 c-6.5-8.8-19-10.6-27.7-4.1L42.3,39.6z"},r.a.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"-360 50 50",repeatCount:"indefinite"})),r.a.createElement("path",{fill:n,d:"M82,35.7C74.1,18,53.4,10.1,35.7,18S10.1,46.6,18,64.3l7.6-3.4c-6-13.5,0-29.3,13.5-35.3s29.3,0,35.3,13.5 L82,35.7z"},r.a.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"2s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"}))))},N=n(106),F=n(621),U=n(606),_=n(624),B=n(625),z=n(620),G=n(611),Y=n(276),V=n.n(Y),W=n(277),q=n.n(W),H=function(){},X=Object(g.a)((function(e){return{root:function(e){return{position:"relative"}},arrowIcon:function(t){return{marginLeft:e.spacing(1)}},tooltip:function(e){return{position:"relative",margin:0}},arrow:function(e){return{position:"absolute",fontSize:6,"&::before":{content:'""',margin:"auto",display:"block",width:0,height:0,borderStyle:"solid"}}},paper:{border:"1px solid #d3d4d5"},popper:function(t){return{'&[x-placement*="bottom"] $arrow':{top:0,left:0,marginTop:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"0 1em 1em 1em",borderColor:"transparent transparent ".concat(e.palette.grey[700]," transparent")}},'&[x-placement*="top"] $arrow':{bottom:0,left:0,marginBottom:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"1em 1em 0 1em",borderColor:"".concat(e.palette.grey[700]," transparent transparent transparent")}},'&[x-placement*="right"] $arrow':{left:0,marginLeft:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 1em 1em 0",borderColor:"transparent ".concat(e.palette.grey[700]," transparent transparent")}},'&[x-placement*="left"] $arrow':{right:0,marginRight:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 0 1em 1em",borderColor:"transparent transparent transparent ".concat(e.palette.grey[700])}}}}}})),K=function(e){var t,n=X(e),c=Object(a.useMemo)(Math.random,[]),o=Object(a.useRef)(),i=Object(a.useState)(null),l=Object(s.a)(i,2),u=l[0],d=l[1],p=Object(a.useState)(null),m=Object(s.a)(p,2),f=m[0],b=m[1];Object(a.useEffect)((function(){return o.current=!0,function(){o.current=!1}}),[]);var v=Object(a.useCallback)((function(e){o.current&&d(e.currentTarget)}),[]),g=Object(a.useCallback)((function(){o.current&&d(null)}),[]),h=Object(a.useCallback)(Object(j.a)(O.a.mark((function t(){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(e.onClose||H)();case 2:!0!==t.sent&&g();case 4:case"end":return t.stop()}}),t)}))),[g,e.onClose]),y=Object(a.useCallback)((function(t){(e.onClickCheckbox||H)(t.target.value,h)}),[e.onClickCheckbox,h]),k=Object(a.useCallback)((function(t){return function(){var n=Object(j.a)(O.a.mark((function n(a){return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("checkbox"!==a.target.type){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,(e.onSelect||H)(t);case 4:!0!==n.sent&&h();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}),[h,e.onSelect]),E=!!u;return r.a.createElement("div",{className:n.root},r.a.createElement(U.a,Object.assign({disableRipple:!0,variant:"outlined","aria-haspopup":"true",className:n.button,onClick:v,"aria-controls":"select-and-check-".concat(c)},e.SelectProps),E&&e.activeTitle||e.title,E?r.a.createElement(V.a,{className:n.arrowIcon}):r.a.createElement(q.a,{className:n.arrowIcon})),r.a.createElement(F.a,Object.assign({keepMounted:!0,open:E,elevation:0,anchorEl:u,getContentAnchorEl:null,onClose:h,id:"select-and-check-".concat(c),classes:{paper:n.paper},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},e.MenuProps),null===(t=e.options)||void 0===t?void 0:t.map((function(t,a){var c=t.key,o=t.value,i=t.text,l=t.selected,s=t.tooltipTitle,u=t.checked,d=t.checkboxValue,p=null;if("boolean"===typeof u){var m=r.a.createElement(z.a,{checked:u,onClick:y,value:void 0===d?o:d}),v=s||e.tooltipTitle;p=v?r.a.createElement(_.a,{classes:{tooltip:n.tooltip,popper:n.popper},PopperProps:{popperOptions:{modifiers:{arrow:{enabled:!!f,element:f}}}},title:r.a.createElement(r.a.Fragment,null,v,r.a.createElement("span",{className:n.arrow,ref:b})),enterDelay:void 0===e.tooltipEnterDelay?750:e.tooltipEnterDelay,leaveDelay:e.tooltipLeaveDelay||0,"aria-label":"checkbox",placement:e.tooltipPlacement||"top"},m):m}return r.a.createElement(B.a,Object.assign({key:c||a,onClick:k(o),selected:l},e.MenuItemProps),p,r.a.createElement(G.a,{primary:i||(null===o||void 0===o?void 0:o.toString())}))}))))},$=Object(g.a)((function(e){return{root:function(e){return{}}}})),Z=function(e){var t,n=k(),c=$(Object(S.a)(Object(S.a)({},e),n)),o=Object(a.useMemo)((function(){var e={deviceId:null,label:null,none:!0};return n.currentDeviceId?(n.cameras.some((function(t){return t.deviceId===n.currentDeviceId&&(e=t,!0)})),e):e}),[n.cameras,n.currentDeviceId]),i=Object(a.useCallback)((function(e){n.currentDeviceId!==e&&n.startVideo({deviceId:e})}),[n]),l=Object(a.useCallback)((function(e){n.autoStartDeviceId===e?n.clearAutoStartDeviceId():(n.setAutoStartDeviceId(e),i(e))}),[n,i]);return r.a.createElement("div",{className:c.root},r.a.createElement(K,{activeTitle:"Select Camera",title:(null===(t=n.cameras)||void 0===t?void 0:t.length)?o.label||"No Camera Selected":"No Cameras Detected",onSelect:i,onClickCheckbox:l,options:n.cameras.map((function(e){return{key:e.label,value:e.deviceId,text:e.label||"Unknown Device",selected:e.deviceId===n.currentDeviceId,checked:n.autoStartDeviceId===e.deviceId,tooltipTitle:n.autoStartDeviceId===e.deviceId?"Remove Default":"Set Default"}}))}))},J=Object(g.a)((function(e){return{root:{position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex",alignItems:"center",justifyContent:"center"},paper:{padding:e.spacing(2),borderRadius:e.spacing(1),display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center","& h1":{marginBottom:e.spacing(2)},"& p":{marginBottom:e.spacing(1)}}}})),Q=function(e){var t=J(e),n=Object(L.c)({transform:"translate3d(0,0px,0)",from:{transform:"translate3d(0,-500px,0)"},config:L.b.slow}),a=Object(L.c)({to:{opacity:e.permissionDenied?1:0},config:L.b.wobbly});return r.a.createElement("div",{className:t.root},r.a.createElement(L.a.div,{style:n},r.a.createElement(I.a,{elevation:4,className:t.paper},r.a.createElement("div",{className:t.container},e.permissionDenied?r.a.createElement(L.a.div,{style:a},r.a.createElement(N.a,{component:"h1",variant:"h6"},"It looks like you have denied webcam access."),r.a.createElement(N.a,{component:"p"},"Please take a look at"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://support.google.com/chrome/answer/2693767"},"this article")," ","in order to enable access."),r.a.createElement(N.a,{component:"p"},"Once your webcam has been enabled, return here to play the game!")):r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{component:"h1",variant:"h6"},"In order to play the game, you must grant permission to access your webcam."),r.a.createElement(N.a,{component:"p"},"Please select a camera."),r.a.createElement(Z,null))))))},ee=Object(g.a)((function(e){return{root:function(t){var n=t.isFullScreen;return Object(S.a)(Object(x.a)({maxWidth:1100,margin:"0 auto",position:"relative",height:"calc(0.5625 * (100vw - ".concat(e.spacing(4),"px))")},"@media(min-width: ".concat(1100,"px)"),{height:n?"100%":"calc(0.5625 * (".concat(1100,"px - ").concat(e.spacing(4),"px))")}),n?{display:"flex",alignItems:"center",justifyContent:"center"}:{})},container:function(t){var n=t.isFullScreen;return{width:"100%",position:"relative",paddingLeft:n?0:e.spacing(2),paddingRight:n?0:e.spacing(2)}},video:function(t){var n=t.flipX,a=t.isFullScreen;return Object(S.a)({width:"100%",height:"100%",borderRadius:a?0:e.spacing(1)},n?{"p-webkit-transform":"scaleX(- 1)",transform:"scaleX(-1)"}:{})},canvas:function(t){var n=t.isFullScreen;return{borderRadius:n?0:e.spacing(1),position:"absolute",top:0,left:0,width:"100%",paddingLeft:n?0:e.spacing(2),paddingRight:n?0:e.spacing(2)}},children:function(t){var n=t.isFullScreen;return{borderRadius:n?0:e.spacing(1),overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",bottom:5,zIndex:1,paddingLeft:n?0:e.spacing(2),paddingRight:n?0:e.spacing(2)}},fullScreen:{position:"absolute",bottom:e.spacing(1.5),right:function(t){var n=t.isFullScreen;return e.spacing(n?1.5:3)},zIndex:20,"&:hover":{background:"rgba(255,255,255,0.25)"}},overlay:function(t){var n=t.overlayColor,a=t.isFullScreen;return{background:n,position:"absolute",top:0,bottom:5,left:a?0:e.spacing(2),right:a?0:e.spacing(2),borderRadius:a?0:e.spacing(1),zIndex:0}},loader:{position:"absolute",top:0,left:0,bottom:0,right:0,width:"100%",display:"flex",alignItems:"center",justifyContent:"center","& > div":{width:100,height:100}},paper:{top:0,bottom:5,zIndex:-1,position:"absolute",left:e.spacing(2),right:e.spacing(2),borderRadius:e.spacing(1)}}})),te=function(e){var t,n,a,c,o,i,l,s,u=e.overlay,d=Object(w.a)(e,["overlay"]),p=k(),m="string"!==typeof u?"rgba(255,255,255,0.5)":u,f=ee(Object(S.a)(Object(S.a)(Object(S.a)({},d),p),{},{overlayColor:m})),b=Object(L.c)({to:{opacity:p.hidden?0:1},config:L.b.stiff});return r.a.createElement("div",{ref:p.rootRef,className:f.root},r.a.createElement(L.a.div,{style:b,className:f.container},r.a.createElement(r.a.Fragment,null,r.a.createElement("video",{autoPlay:!0,ref:p.videoRef,className:f.video,width:null===(t=p.videoRef)||void 0===t||null===(n=t.current)||void 0===n?void 0:n.videoWidth,height:null===(a=p.videoRef)||void 0===a||null===(c=a.current)||void 0===c?void 0:c.videoHeight}),r.a.createElement("canvas",{ref:p.canvasRef,className:f.canvas,width:null===(o=p.videoRef)||void 0===o||null===(i=o.current)||void 0===i?void 0:i.videoWidth,height:null===(l=p.videoRef)||void 0===l||null===(s=l.current)||void 0===s?void 0:s.videoHeight}),!p.hidden&&u&&r.a.createElement("div",{className:f.overlay}),d.children&&!p.hidden&&r.a.createElement("div",{className:f.children},d.children),p.hasFullScreen&&r.a.createElement(T.a,{color:"secondary",className:f.fullScreen,onClick:p.toggleFullScreen},p.isFullScreen?r.a.createElement(P.a,{color:"secondary"}):r.a.createElement(R.a,{color:"secondary"}))),!p.isFullScreen&&r.a.createElement(I.a,{elevation:4,className:f.paper})),p.permissionNeeded?r.a.createElement(Q,{permissionDenied:p.permissionDenied}):p.hidden&&r.a.createElement("div",{className:f.loader},r.a.createElement("div",null,r.a.createElement(D,{color:"#000"}))))},ne=n(27),ae=n.n(ne),re=n(626),ce=n(7),oe=n(282),ie=n.n(oe),le=n(283),se=n.n(le),ue=n(284),de=n.n(ue),pe=n(285),me=n.n(pe);var fe,be,ve,ge,he,Oe,je,ye=function(e){if(!e)throw new Error("audioRef is required when calling useSfx");var t=Object(a.useCallback)((function(t){if(e.current)return function(e){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;var t=new AudioContext,n=t.createBufferSource(),a=new Request(e);return fetch(a).then((function(e){return e.arrayBuffer()})).then((function(e){return t.decodeAudioData(e,(function(e){n.buffer=e,n.connect(t.destination)})),n.start(0)}))}(t)}),[e]);return{playSuccessSound:Object(a.useCallback)((function(){return t("/sounds/metallic_clank.ogg")}),[t]),playFailureSound:Object(a.useCallback)((function(){return t("/sounds/glass_shatter.ogg")}),[t]),playCameraSound:Object(a.useCallback)((function(){return t("/sounds/camera.ogg")}),[t])}},ke=window.speechSynthesis,Ee=function(){var e=Object(a.useRef)(!0),t=Object(a.useState)(!0),n=Object(s.a)(t,2),r=n[0],c=n[1],o=function(e){if(!e)throw new Error("audioRef is required when calling useSpeech");var t=Object(a.useState)(null),n=Object(s.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)(null),i=Object(s.a)(o,2),l=i[0],u=i[1];Object(a.useEffect)((function(){if(!r){var e=ke.getVoices();c(e),u(e[0])}}),[r]);var d=Object(a.useCallback)((function(t){if(e.current){var n=new SpeechSynthesisUtterance(t);n.voice=l,ke.speak(n)}}),[l,e]),p=Object(a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onEnd,a=t.onEach;n&&setTimeout(n,1e3*e),Array.from({length:e}).forEach((function(t,n){var r=e-n;setTimeout((function(){d(r),a&&a(r)}),1e3*n)}))}),[d]);return{say:d,countdown:p}}(e),i=ye(e);Object(a.useEffect)((function(){localStorage.getItem("__audio_muted__")&&c(!1)}),[]),Object(a.useEffect)((function(){r&&!e.current?(e.current=!0,localStorage.removeItem("__audio_muted__")):!r&&e.current&&(e.current=!1,localStorage.setItem("__audio_muted__","true"))}),[r]);var l=Object(a.useCallback)((function(){c((function(e){return!e}))}),[]);return Object(a.useMemo)((function(){return{state:r,stateRef:e,handlers:{toggle:l,speech:o,sfx:i}}}),[r,l,o,i])},Ce=Object(a.createContext)(),we=function(){var e=Object(a.useContext)(Ce);if(void 0===e)throw new Error("useAudio must be used within a AudioProvider");return e},xe=function(e){var t=e.children,n=Ee();return r.a.createElement(Ce.Provider,{value:n},t)},Se="set_screen",Ie="set_player_mode",Te="set_game_mode",Le="reverse_state",Me="reset_state",Re={screen:{DEFAULT:"start",PLAY:"play"},players:{SINGLE_PLAYER:"Single Player",MULTIPLAYER:"Multi Player",DEFAULT:null},mode:(fe={},Object(x.a)(fe,"Single Player",{PRACTICE:"Practice",SURVIVAL:"Survival",TIME_ATTACK:"Time Attack"}),Object(x.a)(fe,"Multi Player",{LOCAL:"Multiplayer",REMOTE:"Remote Multiplayer"}),Object(x.a)(fe,"DEFAULT",null),fe)},Ae=[Re.mode["Multi Player"].REMOTE].reduce((function(e,t){return Object(S.a)(Object(S.a)({},e),{},Object(x.a)({},t,!0))}),{}),Pe=Object.entries(Re).reduce((function(e,t){var n=Object(s.a)(t,2),a=n[0],r=n[1];return Object(S.a)(Object(S.a)({},e),{},Object(x.a)({},a,"mode"!==a?Object.values(r).filter((function(e){return e})):Object.entries(r).reduce((function(e,t){var n=Object(s.a)(t,2),a=n[0],r=n[1];return Object(S.a)(Object(S.a)({},e),{},Object(x.a)({},a,null===r?null:Object.values(r)))}),{})))}),{}),De={screen:Re.screen.DEFAULT,mode:Re.mode.DEFAULT,players:Re.players.DEFAULT},Ne=n(612),Fe=n(613),Ue=n(83),_e=n.n(Ue),Be=n(281),ze=n.n(Be),Ge=Object(g.a)((function(e){return{btn:{border:"2px solid grey"},back:{marginLeft:e.spacing(2)},options:{marginTop:e.spacing(2),paddingLeft:e.spacing(2),paddingRight:e.spacing(2),width:"100%",maxWidth:1100,display:"flex",margin:"0 auto",alignItems:"center",justifyContent:"space-between"},right:{display:"flex",alignItems:"center",justifyContent:"space-between"},volume:{marginLeft:e.spacing(1)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},info:{marginLeft:e.spacing(2),width:"34px",height:"34px"},stickImage:{width:"100%"}}})),Ye=Object(ce.a)((function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}))((function(e){var t=e.children,n=e.classes,a=e.onClose,c=Object(w.a)(e,["children","classes","onClose"]);return r.a.createElement(Ne.a,Object.assign({disableTypography:!0,className:n.root},c),r.a.createElement(N.a,{variant:"h6"},t),a?r.a.createElement(T.a,{"aria-label":"close",className:n.closeButton,onClick:a},r.a.createElement(_e.a,null)):null)})),Ve=Object(ce.a)((function(e){return{root:{padding:e.spacing(2),textAlign:"center"}}}))(Fe.a),We=Object(a.memo)((function(e){var t=Ge(),n=we(),c=Object(a.useState)(!1),o=Object(s.a)(c,2),i=o[0],l=o[1],u=Object(a.useCallback)((function(){l(!1),e.tutorial.markTutorialCompleted()}),[e.tutorial]),d=e.screen===Re.screen.DEFAULT,p=Object(L.c)({to:{opacity:d?0:1},config:L.b.stiff});return r.a.createElement("div",{className:t.options},r.a.createElement("div",null,!d&&r.a.createElement(L.a.div,{style:p},r.a.createElement(T.a,{className:t.btn,size:"small",onClick:e.goHome},r.a.createElement(ie.a,null)),r.a.createElement(T.a,{size:"small",className:ae()(t.btn,t.back),onClick:e.players===Re.players.MULTIPLAYER?e.goHome:e.goBack},r.a.createElement(se.a,null)),r.a.createElement(T.a,{size:"small",className:ae()(t.btn,t.info),onClick:function(){l(!0)}},r.a.createElement("b",null,"i")),r.a.createElement(re.a,{onClose:u,"aria-labelledby":"customized-dialog-title",open:i||!e.tutorial.completed},r.a.createElement(Ye,{id:"customized-dialog-title",onClose:u},"Set Up"),r.a.createElement(Ve,{dividers:!0},r.a.createElement(N.a,{gutterBottom:!0},"Place your webcam at a distance and ensure there is enough space around you to move safely."),r.a.createElement("img",{src:ze.a,className:t.stickImage,alt:"Stick Figure"}))))),r.a.createElement("div",{className:t.right},r.a.createElement(Z,null),r.a.createElement(T.a,{className:t.volume,size:"small",onClick:n.handlers.toggle},n.state?r.a.createElement(de.a,null):r.a.createElement(me.a,null))))})),qe=Object(g.a)((function(e){return{root:{marginLeft:e.spacing(2)},heading:{marginBottom:e.spacing(1)}}})),He=function(e){var t,n,a,c,o=qe(),i=k(),l=ea(),s=Object(L.c)({to:{opacity:i.hidden?0:1},config:L.b.stiff}),u=i.hidden?"":(null===l||void 0===l||null===(t=l.screen)||void 0===t||null===(n=t.state)||void 0===n?void 0:n.mode)||("play"===(null===l||void 0===l||null===(a=l.screen)||void 0===a||null===(c=a.state)||void 0===c?void 0:c.screen)?"Choose Mode":"Select Players");return r.a.createElement("header",{className:o.root},r.a.createElement(N.a,{component:"h1",variant:"h6",className:o.heading},r.a.createElement(L.a.div,{style:s},u)))},Xe=Object(g.a)((function(e){return{root:{marginTop:e.spacing(2)}}})),Ke=(ve={},Object(x.a)(ve,Re.screen.DEFAULT,Object(x.a)({},Re.players.DEFAULT,null)),Object(x.a)(ve,Re.screen.PLAY,(be={},Object(x.a)(be,Re.players.SINGLE_PLAYER,null),Object(x.a)(be,Re.players.MULTIPLAYER,null),be)),ve),$e=function(e){var t,n=Xe(),a=e.screenState,c=a.screen,o=a.players,i=(null===(t=Ke[c])||void 0===t?void 0:t[o])||He;return r.a.createElement("header",{className:n.root},r.a.createElement(i,null))},Ze=function(){return null},Je=n(614),Qe=n(286),et=n.n(Qe),tt=function(e){var t=(e-25)/63;return Math.max(1,Math.min(10,Math.round(10*t)))},nt=function(e,t){var n,a;e<50?(n=255,a=Math.round(5.1*e)):(a=255,n=Math.round(510-5.1*e));var r="#"+("000000"+(65536*n+256*a+0).toString(16)).slice(-6);if(t)try{var c=et()(r),o=c.red,i=c.green,l=c.blue;return"rgba(".concat(o,", ").concat(i,", ").concat(l,", ").concat(t,")")}catch(s){return console.error(s,{score:e,alpha:t,hex:r}),"rgba(255, 255, 255, 0)"}return r},at=function(e,t){return nt(function(e){return(e=Math.min(Math.max(e,0),10))/10*100}(e),t)},rt=Object(Je.a)((function(e){return{masks:{padding:e.spacing(2),background:"rgba(255,255,255,0.5)"},masksHeader:{display:"flex",alignItems:"center",justifyContent:"space-between"},masksList:{display:"flex",flexFlow:"row wrap",justifyContent:"space-around"},maskContainer:{marginTop:e.spacing(2)},imgContainer:{width:200,position:"relative",border:"1px solid grey",padding:e.spacing(.5),borderRadius:e.spacing(1),"&:hover":{"& > div":{background:"rgba(255,0,0,0.65)"}}},img:{width:"100%",background:"rgba(0,0,0,0)"},removeMask:{top:0,left:0,bottom:0,width:"100%",display:"flex",alignItems:"center",position:"absolute",transition:"all 100ms",justifyContent:"center","&:hover":{"& > button":{display:"inherit"}}},iconBtn:{display:"none",color:"black",backgroundColor:"rgba(255,255,255,0.5)","&:hover":{backgroundColor:"rgba(255,255,255,0.75)"},"&:active, &:focused":{backgroundColor:"rgba(255,255,255,0.9)"}},actions:{"& > button":{marginRight:e.spacing(1),"& :last-of-type":{marginRight:0}}}}})),ct=function(e){var t=rt(),n=e.masks,a=e.onClose,c=e.title,o=e.actions,i=e.actionButtons,l=e.getDataUri,s=e.getImageChild,u=e.getPaperProps,d=e.PaperProps,p=void 0===d?{}:d;return!!(null===n||void 0===n?void 0:n.length)&&r.a.createElement(I.a,{className:t.masks,elevation:4},r.a.createElement("div",{className:t.masksHeader},"string"===typeof c?r.a.createElement(N.a,{variant:"h6",component:"h3"},c):c||null,o||i?r.a.createElement("div",{className:t.actions},i.map((function(e){var t=e.Icon,n=e.onClick,a=e.key;return r.a.createElement(T.a,{key:a,size:"small",onClick:n},r.a.createElement(t,null))}))):a&&r.a.createElement("div",{className:t.actions},r.a.createElement(T.a,{size:"small",onClick:a},r.a.createElement(_e.a,null)))),r.a.createElement("ul",{className:t.masksList},n.map((function(e,a){var c=l?l(e):e,o=u?u(e,a,n):{};return r.a.createElement("li",{key:c,className:t.maskContainer},r.a.createElement(I.a,Object.assign({elevation:4,className:t.imgContainer},p,o),s&&s(e,a),r.a.createElement("img",{src:c,className:t.img,alt:"mask #".concat(a)})))}))))},ot=Object(Je.a)((function(e){return{score:{textAlign:"right",paddingRight:e.spacing(1)}}})),it=function(e){var t=e.results,n=e.handleClose,c=e.label,o=Object(w.a)(e,["results","handleClose","label"]),i=ot(),l=Object(a.useMemo)((function(){var e=(t.reduce((function(e,t){return e+t.score}),0)/t.length).toFixed(1);return r.a.createElement(N.a,{variant:"h6",component:"h3"},c||r.a.createElement(r.a.Fragment,null,"Round Score: ",e))}),[t,c]),s=Object(a.useCallback)((function(e){return e.dataUri}),[]),u=Object(a.useCallback)((function(e){var t=e.score;return{style:{background:at(t,.4)}}}),[]),d=Object(a.useCallback)((function(e){var t=e.score;return r.a.createElement(N.a,{className:i.score},t)}),[i.score]);return r.a.createElement(ct,Object.assign({title:l,masks:t,onClose:n,getDataUri:s,getPaperProps:u,getImageChild:d},o))},lt=n(127),st=n.n(lt),ut=n(287),dt=n.n(ut),pt=n(288),mt=n.n(pt),ft=Object(Je.a)((function(e){return{removeMask:{top:0,left:0,bottom:0,width:"100%",display:"flex",alignItems:"center",position:"absolute",transition:"all 100ms",justifyContent:"center","&:hover":{"& > button":{display:"inherit"}}},iconBtn:{display:"none",color:"black",backgroundColor:"rgba(255,255,255,0.5)","&:hover":{backgroundColor:"rgba(255,255,255,0.75)"},"&:active, &:focused":{backgroundColor:"rgba(255,255,255,0.9)"}}}})),bt=function(e){var t=ft(),n=e.captureMasks,c=e.handlePlay,o=Object(a.useMemo)((function(){return[{key:"play",Icon:st.a,onClick:c},{key:"download",Icon:dt.a,onClick:n.downloadMasks},{key:"clear",Icon:_e.a,onClick:n.removeAllMasks}]}),[n.downloadMasks,n.removeAllMasks,c]),i=Object(a.useCallback)((function(e){return e.binary}),[]),l=Object(a.useCallback)((function(e,a){return r.a.createElement("div",{className:t.removeMask},r.a.createElement(T.a,{name:a,className:t.iconBtn,onClick:n.removeMask},r.a.createElement(mt.a,{fontSize:"large"})))}),[n.removeMask,t.removeMask,t.iconBtn]);return r.a.createElement(ct,{title:"Candidate Masks",getDataUri:i,masks:n.masks,actionButtons:o,getImageChild:l})},vt=Object(Je.a)((function(e){return{score:{textAlign:"right",paddingRight:e.spacing(1)}}})),gt=function(e){var t=ea(),n=vt(),c=Object(a.useMemo)((function(){var e;return"time attack"===(null===t||void 0===t||null===(e=t.mode)||void 0===e?void 0:e.name)?{getPaperProps:function(e){var t=e.score;return{style:{background:at(Math.max(10.5-t,0),.4)}}},getImageChild:function(e){var t=e.score;return r.a.createElement(N.a,{className:n.score},t,"s")}}:{}}),[t,n.score]);if(!t.mode)return null;var o=t.mode,i=o.simpleGame,l=o.captureMasks,s=o.handlePlayCapturedMasks,u=o.resultsText,d="time attack"!==o.name||!t.loop.looping;return r.a.createElement(r.a.Fragment,null,d&&r.a.createElement(it,Object.assign({label:u,results:i.scores,handleClose:e.hideClose?null:i.clearScores},c)),l&&r.a.createElement(bt,{captureMasks:l,handlePlay:s}))},ht=Object(g.a)((function(e){return{root:function(e){var t=e.flip,n=e.height,a=void 0===n?10:n,r=e.background;return{height:a,background:void 0===r?"rgba(255,255,255,0)":r,width:"100%",borderRadius:50,transform:"scaleX(".concat(t?-1:1,")"),pWebkitTransform:"scaleX(".concat(t?-1:1,")")}},filler:function(e){var t=e.completed;return{height:"100%",textAlign:"left",background:e.color,width:"".concat(t,"%"),borderRadius:"inherit"}}}})),Ot=function(e){var t=ht(e);return r.a.createElement("div",{className:t.root},r.a.createElement("div",{className:t.filler}))},jt=n(31),yt=n(105),kt=n.n(yt),Et=n(289),Ct=n.n(Et),wt=(n(290),function(e,t){for(var n=e.data,a=e.width,r=e.height,c=new Uint8ClampedArray(4*e.data.length),o=0;o<r*a;++o){var i=o%a,l=parseInt(o/a),s=n[o],u=t?a-i+a*l:o;c[4*u]=s?255:0,c[4*u+1]=s?255:0,c[4*u+2]=s?255:0,c[4*u+3]=s?255:0}var d=new ImageData(c,a,r),p=cv.matFromImageData(d),m=new cv.MatVector;cv.split(p,m);var f=new cv.Mat;cv.threshold(m.get(0),f,128,1,cv.THRESH_BINARY);var b=new cv.MatVector,v=new cv.Mat;cv.findContours(f,b,v,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE);for(var g=cv.Mat.zeros(f.rows,f.cols,cv.CV_8UC1),h=0;h<b.size();++h)cv.contourArea(b.get(h))>1e4&&cv.drawContours(g,b,h,[1,1,1,1],-1,cv.LINE_8,v,100);return p.delete(),m.delete(),g}),xt=function(e,t){var n=wt(e,t),a=new cv.MatVector,r=cv.Mat.zeros(n.rows,n.cols,cv.CV_8UC4);cv.split(r,a),a.get(2).setTo([255,0,0,0],n),a.get(3).setTo([128,0,0,0],n);var c=new cv.Mat,o=cv.Mat.ones(10,10,cv.CV_8U),i=new cv.Point(-1,-1);cv.dilate(n,c,o,i,1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.subtract(c,n,c),a.get(2).setTo([255,0,0,0],c),a.get(1).setTo([255,0,0,0],c),a.get(3).setTo([255,0,0,0],c),cv.merge(a,r);var l=new ImageData(new Uint8ClampedArray(r.data),r.cols,r.rows);return a.delete(),n.delete(),r.delete(),o.delete(),c.delete(),{overlayImageData:l,binaryImageData:l}},St=function(e,t,n){for(var a=t.data,r=t.width,c=t.height,o=new Uint8ClampedArray(4*t.data.length),i=0,l=0,s=0;s<c*r;++s){var u=s%r,d=parseInt(s/r),p=n?r-u+r*d:s,m=a[s],f=!!e.data[4*p+2],b=f&&m,v=f&&!m,g=!f&&m,h=g||b||v;b&&l++,(m||f)&&i++,o[4*p]=g?255:0,o[4*p+1]=b?255:0,o[4*p+2]=v?255:0,o[4*p+3]=h?128:0}return Math.round(l/(i+1e-7)*100)},It=function(e,t,n){var a=wt(t,n),r=new cv.MatVector,c=cv.Mat.zeros(a.rows,a.cols,cv.CV_8UC4);cv.split(c,r),r.get(1).setTo([255,0,0,0],a),r.get(3).setTo([128,0,0,0],a);var o=new cv.Mat,i=cv.Mat.ones(10,10,cv.CV_8U),l=new cv.Point(-1,-1);cv.dilate(a,o,i,l,1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.subtract(o,a,o),r.get(1).setTo([255,0,0,0],o),r.get(3).setTo([255,0,0,0],o),cv.merge(r,c);var s=new ImageData(new Uint8ClampedArray(c.data),c.cols,c.rows),u=cv.matFromImageData(e),d=new cv.MatVector;cv.split(u,d);var p=new cv.Mat;cv.addWeighted(c,.5,u,.5,0,p);var m=new ImageData(new Uint8ClampedArray(p.data),p.cols,p.rows),f=St(e,t,n);return r.delete(),a.delete(),c.delete(),i.delete(),o.delete(),p.delete(),{score:f,targetOverlay:m,segOverlay:s}},Tt=function(e,t){if("undefined"!==typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,t);if("undefined"!==typeof navigator.msSaveBlob)return navigator.msSaveBlob(e,t);var n=window.document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t,n.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(n),"function"===typeof n.click?n.click():(n.target="_blank",n.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),URL.revokeObjectURL(n.href)},Lt=function(e){return"set".concat(e,".zip")},Mt=function(e){var t=k(),n=Object(a.useState)(!1),r=Object(s.a)(n,2),c=r[0],o=r[1],i=Object(a.useCallback)(function(){var n=Object(j.a)(O.a.mark((function n(a){var r,c,i;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,kt.a.loadAsync(a);case 2:return r=n.sent,console.log("DATA",r),n.next=6,Promise.all(r.filter((function(e){return e.endsWith(".png")})).map((function(e){var t=e.name;return r.file(t).async("base64")})));case 6:return c=n.sent,n.prev=7,console.log("Getting MASK!",c),n.next=11,Promise.all(c.map((function(e){return t.dataUriToImageData("data:image/png;base64,".concat(e))})));case 11:i=n.sent,console.log("GOT MASK!"),e(i),n.next=19;break;case 16:n.prev=16,n.t0=n.catch(7),console.log("UH OH");case 19:o(!1);case 20:case"end":return n.stop()}}),n,null,[[7,16]])})));return function(e){return n.apply(this,arguments)}}(),[e,t]),l=Object(a.useCallback)(function(){var e=Object(j.a)(O.a.mark((function e(t){var n,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(s.a)(t,1),"application/zip"===(a=n[0]).type){e.next=4;break}return console.error("Expected a zip file but got",a.type),e.abrupt("return");case 4:return o(!0),e.next=7,i(a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i]),u=Object(a.useCallback)(function(){var e=Object(j.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return o(!0),e.next=5,new kt.a.external.Promise((function(e,n){Ct.a.getBinaryContent(""+"/masks/".concat(t),(function(t,a){t?n(t):e(a)}))}));case 5:return n=e.sent,console.log("YEAH",n),e.next=9,i(n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i]),d=Object(a.useCallback)(Object(j.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.floor(3*Math.random()),e.abrupt("return",u(Lt(t+1)));case 2:case"end":return e.stop()}}),e)}))),[u]);return Object(a.useMemo)((function(){return{loading:c,handleZipInputChange:l,handleLoadRandomMaskSet:d,handleLoadPreparedMasks:u}}),[c,l,u,d])},Rt=function(){var e=Object(a.useRef)([]),t=Object(a.useRef)(null),n=Object(a.useRef)(0),r=Object(a.useState)([]),c=Object(s.a)(r,2),o=c[0],i=c[1],l=Object(a.useCallback)((function(t){i(t),e.current="function"===typeof t?t(e.current):t}),[]),u=Object(a.useCallback)((function(){n.current=0,t.current=null}),[]),d=Object(a.useCallback)((function(){for(var t,n,a=o.slice(),r=a.length;0!==r;)n=Math.floor(Math.random()*r),t=a[r-=1],a[r]=a[n],a[n]=t;l(a),e.current=a}),[o,l]),p=Object(a.useCallback)((function(){n.current=0,t.current=null,d()}),[d]),m=Object(a.useCallback)((function(){var a=e.current[n.current];return a?(t.current=a,n.current++,a):(t.current=null,n.current=0,null)}),[]),f=Object(a.useCallback)((function(){return e.current.length}),[]),b=Object(a.useCallback)((function(){var e=o[Math.floor(Math.random()*o.length)];return t.current=e,e}),[o]);return Object(a.useMemo)((function(){return{next:m,reset:u,random:b,maskRef:t,setMasks:l,maskIdxRef:n,getNumMasks:f,resetAndShuffle:p,hasMasks:!!o.length}}),[m,o,b,u,l,p,f])},At=Object(a.createContext)(),Pt=function(){var e=Object(a.useContext)(At);if(void 0===e)throw new Error("useCarbon must be used within a CarbonProvider");return e},Dt=function(e){var t=e.children,n=function(){var e=we().handlers.speech.say,t=Object(a.useRef)(),n=Object(a.useState)(!1),r=Object(s.a)(n,2),c=r[0],o=r[1];Object(a.useEffect)((function(){c&&!t.current?t.current=!0:!c&&t.current&&(t.current=!1)}),[c]);var i=Object(a.useCallback)((function(){o((function(t){return t||e("Carbon Activated!"),!t}))}),[e]);return window.__carbonate__=i,{carbonState:c,carbonRef:t}}();return r.a.createElement(At.Provider,{value:n},t)},Nt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.setLapTimeInfo,n=Object(a.useRef)(),r=k(),c=Pt(),o=c.carbonRef,i=Object(a.useRef)(0),l=Rt(),u=Object(a.useRef)(0),d=Object(a.useState)([]),p=Object(s.a)(d,2),m=p[0],f=p[1],b=Object(a.useState)([[],[]]),v=Object(s.a)(b,2),g=v[0],h=v[1],y=Mt(l.setMasks),E=we(),C=E.handlers,w=C.sfx,x=w.playSuccessSound,S=w.playFailureSound,I=C.speech.say,T=Object(a.useCallback)((function(){f([]),h([[],[]])}),[]),L=Object(a.useCallback)((function(e){return function(){var a=Object(j.a)(O.a.mark((function a(c){return O.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return c.time.first&&(l.next(),e||T(),c.useTimer({maxLaps:l.getNumMasks(),setLapTimeInfo:t,announceSeconds:!0,onLap:function(t){var a=t.predict,c=(t.time,t.stop),o=l.maskRef.current;if(!o)return c();n.current=a(r.videoRef.current).then(function(){var t=Object(j.a)(O.a.mark((function t(n){var a,c,i,s;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=It(o,n,r.flipX),c=a.score,i=a.targetOverlay,s=r.imageDataToDataUri(i),void 0!==e?h((function(t){var n=Object(jt.a)(t);return n[e]=[].concat(Object(jt.a)(n[e]),[{score:tt(c),dataUri:s}]),n})):f((function(e){return[].concat(Object(jt.a)(e),[{score:tt(c),dataUri:s}])})),r.clearCanvas(),l.next();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})),l.maskRef.current&&r.ctx.putImageData(l.maskRef.current,0,0),a.abrupt("return",(function(){n.current?n.current.then(c.webcam.clearCanvas):c.webcam.clearCanvas()}));case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}),[r,l,t,T]),M=Object(a.useCallback)((function(){return L()}),[L]),R=Object(a.useCallback)((function(e){return L(e)}),[L]),A=Object(a.useCallback)(function(){var e=Object(j.a)(O.a.mark((function e(a){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.time.first&&(l.random(),T(),a.useTimer({maxLaps:9999999,lapDuration:1e4,setLapTimeInfo:t,announceSeconds:!0,onLap:function(e){var t=e.predict,c=(e.time,e.stop),i=l.maskRef.current;if(!i)return c();n.current=t(r.videoRef.current).then(function(){var e=Object(j.a)(O.a.mark((function e(t){var n,s,u,d,p,m;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=It(i,t,r.flipX),s=n.score,u=n.targetOverlay,4,(d=tt(s))<4?o.current?I("Missed it!"):S():o.current?I("Got it!"):x(),p=r.imageDataToDataUri(u),f((function(e){return[].concat(Object(jt.a)(e),[{score:tt(s),dataUri:p}])})),r.clearCanvas(),!(d<4)){e.next=12;break}return l.reset(),e.abrupt("return",c());case 12:m=a.timerRef.current.lapDuration/1e3,a.timerRef.current.lapDuration=1e3*(m-Math.log(m)/Math.log(50))-100,l.random();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}})),l.maskRef.current&&r.ctx.putImageData(l.maskRef.current,0,0),e.abrupt("return",(function(){n.current?n.current.then(a.webcam.clearCanvas):a.webcam.clearCanvas()}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,l,t,T,o,S,x,I]),P=Object(a.useCallback)(function(){var e=Object(j.a)(O.a.mark((function e(a){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.time.first&&(l.resetAndShuffle(),l.next(),T(),i.current=0,u.current=0,a.useTimer({setLapTimeInfo:t,announceSeconds:!1,lapDuration:250,postLapDelay:0,onLap:function(e){var t=e.predict,a=e.time,c=e.stop,s=l.maskIdxRef.current,d=l.maskRef.current;if(!d)return i.current=0,l.reset(),c();if(!(i.current>=s)){var p=a.elapsed-u.current;if(p/1e3>=10){u.current=a.elapsed,o.current?I("Missed it!"):S();var m=r.imageDataToDataUri(d);f((function(e){return[].concat(Object(jt.a)(e),[{score:10,dataUri:m}])})),r.clearCanvas(),l.next(),i.current++}n.current=t(r.videoRef.current).then(function(){var e=Object(j.a)(O.a.mark((function e(t){var n,c,m,b,v,g;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=St(d,t,r.flipX),!(tt(n)>5)){e.next=15;break}if(!(i.current>=s)){e.next=5;break}return e.abrupt("return");case 5:o.current?I("Got it!"):x(),c=p/1e3,u.current=a.elapsed,m=Number(c.toFixed(1)),b=It(d,t,r.flipX),v=b.targetOverlay,g=r.imageDataToDataUri(v),f((function(e){return[].concat(Object(jt.a)(e),[{score:m,dataUri:g}])})),r.clearCanvas(),l.next(),i.current++;case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(console.error)}}})),l.maskRef.current&&r.ctx.putImageData(l.maskRef.current,0,0),e.abrupt("return",(function(){n.current?n.current.then(a.webcam.clearCanvas):a.webcam.clearCanvas()}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,l,T,t,S,x,o,I]);return Object(a.useMemo)((function(){return{zip:y,scores:m,multiplayerScores:g,handleLoop:M,handleMultiplayerLoop:R,handleSurvivalLoop:A,handleTimeAttackLoop:P,clearScores:T,reset:l.reset,ready:l.hasMasks,setMasks:l.setMasks}}),[y,m,g,M,R,A,P,T,l.hasMasks,l.reset,l.setMasks])},Ft=n(291),Ut=n.n(Ft),_t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.maxMasks,n=void 0===t?0:t,r=e.setLapTimeInfo,c=Object(a.useRef)(),o=Object(a.useRef)([]),i=Object(a.useRef)(),l=Object(a.useState)([]),u=Object(s.a)(l,2),d=u[0],p=u[1],m=Pt(),f=m.carbonRef,b=we(),v=b.handlers,g=v.sfx.playCameraSound,h=v.speech.say,y=Object(a.useCallback)((function(e){"function"===typeof e?p((function(t){var n=e(t);return n!==t&&(o.current=n),n})):(o.current=e,p(e))}),[]),k=Object(a.useCallback)((function(){return o.current}),[]),E=Object(a.useCallback)((function(e){var t=e.currentTarget.name;y((function(e){return e.filter((function(e,n){return n!==+t}))}))}),[y]),C=Object(a.useCallback)((function(){y([])}),[y]),w=Object(a.useCallback)((function(){var e=new kt.a,t=e.folder("masks");d.forEach((function(e,n){var a=e.overlay;t.file("mask-".concat(n,".png"),Ut.a.decode(a).dataBase64,{base64:!0})})),e.generateAsync({type:"blob"}).then((function(e){return Tt(e,"masks.zip")}))}),[d]),x=Object(a.useCallback)((function(e){return function(){var t=Object(j.a)(O.a.mark((function t(a){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.time.first&&(i.current=d.length,a.useTimer({announceSeconds:!0,lapDuration:3e3,postLapDelay:2500,maxLaps:n,setLapTimeInfo:r,onBeforeStartLap:function(){var e=Object(j.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.predict,t.webcam,t.time,t.stop,e.abrupt("return",n());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onLap:function(e){var t=e.predict,a=e.webcam,r=(e.time,e.stop);c.current=t(a.videoRef.current).then(function(){var e=Object(j.a)(O.a.mark((function e(t){var c,o,l,s,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=xt(t,a.flipX),o=c.overlayImageData,l=c.binaryImageData,f.current?h("Gotcha!"):g(),s=a.imageDataToDataUri(o),u=a.imageDataToDataUri(l),a.clearCanvas(),a.ctx.putImageData(o,0,0),y((function(e){return[].concat(Object(jt.a)(e),[{overlay:s,binary:u}])})),e.next=9,new Promise((function(e){return setTimeout(e,1500)}));case 9:if(a.clearCanvas(),!(n&&++i.current>n)){e.next=12;break}return e.abrupt("return",r());case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},onEnd:function(){var e=Object(j.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.time,n=t.webcam,t.predict,t.stop,e.next=3,new Promise((function(e){return setTimeout(e,2e3)}));case 3:n.clearCanvas();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})),t.abrupt("return",(function(){c.current?c.current.then(a.webcam.clearCanvas).then((function(){e&&e()})):(a.webcam.clearCanvas(),e&&e())}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),[d.length,n,r,y,g,h,f]);return Object(a.useMemo)((function(){return{masks:d,getMasks:k,handleLoop:x,removeMask:E,downloadMasks:w,removeAllMasks:C}}),[d,k,x,E,w,C])},Bt={percent:0,percentRemaining:100,color:nt(100),secondsRemaining:0},zt=function(e){var t=Object(a.useState)(Bt),n=Object(s.a)(t,2),r=n[0],c=n[1],o=Nt({setLapTimeInfo:c}),i=_t({setLapTimeInfo:c}),l=Object(a.useMemo)((function(){var e,t;return"You survived ".concat((null===o||void 0===o||null===(e=o.scores)||void 0===e?void 0:e.length)-1," round").concat(2!==(null===o||void 0===o||null===(t=o.scores)||void 0===t?void 0:t.length)?"s":"",".")}),[o.scores]),u=Object(a.useRef)(!1);Object(a.useEffect)((function(){u.current||(u.current=!0,o.zip.handleLoadPreparedMasks("survival_2.zip"))}),[o]);var d=Object(a.useCallback)(Object(j.a)(O.a.mark((function t(){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.looping?e.stop():e.start(o.handleSurvivalLoop);case 1:case"end":return t.stop()}}),t)}))),[e,o]),p=Object(a.useCallback)((function(){e.looping?e.stop():e.start(i.handleLoop())}),[e,i]);return Object(a.useMemo)((function(){return{name:"survival",loop:e,simpleGame:o,lapTimeInfo:r,resultsText:l,captureMasks:i,handleClickGame:d,handleClickCaptureMasks:p}}),[e,o,r,l,i,d,p])},Gt=n(615),Yt=n(293),Vt=n.n(Yt),Wt=n(292),qt=n.n(Wt),Ht=Object(Je.a)((function(e){return{paper:{position:"relative",padding:e.spacing(1),paddingRight:e.spacing(5),paddingLeft:e.spacing(5),background:"rgba(255,255,255,0.95)",marginTop:e.spacing(2),textAlign:"center","& h2":{marginBottom:e.spacing(4)},"& h3":{marginBottom:e.spacing(1)}},help:{maxHeight:200,marginTop:e.spacing(2),"& > div > p":{marginBottom:e.spacing(1),fontSize:16}},helpBtn:{position:"absolute",bottom:e.spacing(1),right:e.spacing(1)},icon:{fontSize:50},marginTop:{marginTop:e.spacing(2)}}})),Xt=function(e){var t=e.headerContent,n=e.middleContent,c=e.footerContent,o=e.primaryText,i=e.secondaryText,l=e.helpContent,u=e.iconProps,d=(u=void 0===u?{}:u).loading,p=Object(w.a)(u,["loading"]),m=e.Icon,f=Object(a.useState)(!1),b=Object(s.a)(f,2),v=b[0],g=b[1],h=Object(a.useCallback)((function(){g((function(e){return!e}))}),[]),O=Ht(),j=Object(a.useMemo)((function(){return d?Gt.a:{play:st.a,replay:qt.a}[m]||m}),[m,d]);return r.a.createElement(I.a,{className:O.paper},t,o&&r.a.createElement(N.a,{component:"h3",variant:"h5"},o),n,i&&r.a.createElement(N.a,{component:"h4",variant:"h6",className:ae()(O.subtext,Object(x.a)({},O.marginTop,n))},i),j&&r.a.createElement(T.a,Object.assign({size:"medium",disabled:d},p),r.a.createElement(j,{className:O.icon,color:p.color||"primary"})),c,l&&r.a.createElement("div",{className:O.help},v&&r.a.createElement("div",{className:O.helpContent},Array.isArray(l)?r.a.createElement(r.a.Fragment,null,l.map((function(e){return r.a.createElement("p",{key:e},e)}))):l),r.a.createElement(T.a,{size:"small",className:O.helpBtn,onClick:h},r.a.createElement(Vt.a,null))))},Kt=Object(Je.a)((function(e){return{root:{padding:e.spacing(1),height:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},overlay:{background:"rgba(255,255,255,0.5)"},options:{display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"space-between",marginBottom:e.spacing(1),"& > *":{marginTop:e.spacing(2)}},optionsTop:{justifyContent:"center",alignItems:"center",flexDirection:"row",width:"100%",paddingLeft:e.spacing(10),paddingRight:e.spacing(10)},progress:{position:"absolute",top:e.spacing(1),left:e.spacing(8),right:e.spacing(8)}}})),$t=function(e,t,n){return t===n.length-1?{style:{background:"rgba(255, 0, 0, 0.4)"}}:{}},Zt=function(e){var t=Kt(),n=ta(zt),a=k(),c=n.loop,o=n.lapTimeInfo,i=n.handleClickGame;return r.a.createElement("div",{className:ae()(t.root,Object(x.a)({},t.overlay,!c.looping))},r.a.createElement("div",{className:ae()(t.options,Object(x.a)({},t.optionsTop,!!c.looping))},c.looping?r.a.createElement("div",{className:t.progress},r.a.createElement(Ot,{color:o.color,completed:o.percentRemaining})):r.a.createElement(Xt,{primaryText:"Survival",secondaryText:"Match the poses and survive as long as you can.",middleContent:a.isFullScreen&&r.a.createElement(Jt,null),Icon:"play",iconProps:{onClick:i,loading:!c.ready,color:"secondary"},helpContent:["You will have a limited number of time to match each pose.","Successfully match a pose by being within its lines when the timer runs out.","If your score is high enough, you will move on to the next round.","You will have less time each round.","How long can you survive?"]})))},Jt=function(e){var t=ea();if(!t.mode)return null;var n=t.mode,a=n.simpleGame,c=n.resultsText;return!t.loop.looping&&r.a.createElement(it,{label:c,getImageChild:null,results:a.scores,handleClose:a.clearScores,getPaperProps:$t})},Qt=Object(Je.a)((function(e){return{root:function(t){return{minWidth:t.isFullScreen?"50%":"auto","& > div:first-of-type":{marginTop:e.spacing(2),marginBottom:e.spacing(2)}}}}})),en=function(e){var t=ea(),n=Qt(e);if(!t.mode)return null;var a=t.mode,c=a.simpleGame,o=a.multiplayerResultsText;return!t.loop.looping&&r.a.createElement("div",{className:n.root},r.a.createElement(it,{label:o[0],results:c.multiplayerScores[0]}),r.a.createElement(it,{label:o[1],results:c.multiplayerScores[1]}))},tn=Object(g.a)((function(e){return{root:{maxWidth:1100,margin:"0 auto",paddingLeft:e.spacing(2),paddingRight:e.spacing(2),"& > div":{marginTop:e.spacing(2)}}}})),nn=Object(x.a)({},Re.screen.PLAY,(Oe={},Object(x.a)(Oe,Re.players.SINGLE_PLAYER,(ge={},Object(x.a)(ge,Re.mode[Re.players.SINGLE_PLAYER].PRACTICE,gt),Object(x.a)(ge,Re.mode[Re.players.SINGLE_PLAYER].SURVIVAL,Jt),Object(x.a)(ge,Re.mode[Re.players.SINGLE_PLAYER].TIME_ATTACK,gt),ge)),Object(x.a)(Oe,Re.players.MULTIPLAYER,(he={},Object(x.a)(he,Re.mode[Re.players.MULTIPLAYER].LOCAL,en),Object(x.a)(he,Re.mode[Re.players.MULTIPLAYER].REMOTE,(function(){return"REMOTE footer"})),he)),Oe)),an=function(e){var t,n,a=tn(),c=e.screen.state,o=c.screen,i=c.players,l=c.mode,s=(null===(t=nn[o])||void 0===t||null===(n=t[i])||void 0===n?void 0:n[l])||Ze;return r.a.createElement("div",{className:a.root},r.a.createElement(s,null))},rn=Object(Je.a)((function(e){return{root:{display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"space-between",marginBottom:e.spacing(1),"& > div > *":{marginTop:e.spacing(2)}},buttons:{display:"flex"},h:{flexDirection:"row"},v:{flexDirection:"column"},minWidth:{minWidth:150},label:{color:"white",fontWeight:"bold",background:e.palette.primary.main,padding:e.spacing(1),borderRadius:e.spacing(1),border:"".concat(e.spacing(.5),"px solid white")},icon:{fontSize:120,border:"".concat(e.spacing(.5),"px solid white"),borderRadius:"50%",padding:e.spacing(1),background:e.palette.secondary.main,color:"white"}}})),cn=function(e){return{transform:"translate3d(0,0px,0)",from:{transform:"translate3d(0,-".concat(e,"px,0)")},config:L.b.wobbly}},on=function(e){var t,n=rn(),a=Object(L.d)(e.buttons.length,cn(e.offset||100)),c=Object(L.d)(1,cn((e.offset||100)+200));return r.a.createElement("div",{className:n.root},e.label&&c.map((function(t,a){return r.a.createElement(L.a.div,{style:t},r.a.createElement(N.a,{component:"h2",variant:"h3",className:n.label},e.label))})),r.a.createElement("div",{className:ae()(n.buttons,(t={},Object(x.a)(t,n.h,"h"===e.layout),Object(x.a)(t,n.v,"h"!==e.layout),t))},a.map((function(t,a){var c=e.buttons[a],o=c.Component,i=c.visible,l=void 0===i||i,s=c.props,u=(s=void 0===s?{}:s).Icon,d=Object(w.a)(s,["Icon"]);return l?r.a.createElement(L.a.div,{key:d.key,style:t},o?r.a.createElement(o,d):u?r.a.createElement(T.a,Object.assign({size:"large",variant:"contained",className:n.iconButton},d),r.a.createElement(u,{className:n.icon})):r.a.createElement(U.a,Object.assign({color:"primary",variant:"contained"},d,{className:n.minWidth}))):null}))))},ln=Object(g.a)((function(e){return{root:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column","& button":{marginTop:e.spacing(2)}},gameMode:{textAlign:"center"},header:{marginTop:e.spacing(4),marginBottom:e.spacing(2)}}})),sn=function(e){var t=ln(),n=Pt().carbonState,c=Object(a.useCallback)((function(t){var n=t.currentTarget.name;e.screen.handlers.setGameMode(n)}),[e.screen.handlers]),o=Object(a.useMemo)((function(){var t;return null===(t=Pe.mode[e.screen.state.players])||void 0===t?void 0:t.map((function(e){return{props:{key:e,name:e,children:e,onClick:c,disabled:!!Ae[e]}}})).filter((function(e){return!!n||"Practice"!==e.props.name}))}),[e.screen.state.players,c,n]);return r.a.createElement("div",{className:t.root},r.a.createElement("div",{className:t.gameMode},r.a.createElement(on,{buttons:o})))},un=Object(g.a)((function(e){return{fileInput:{display:"none"}}})),dn=function(e){var t=e.onChange,n=e.multiple,c=e.children,o=e.filter,i=Object(w.a)(e,["onChange","multiple","children","filter"]),l=un(),s=Object(a.useRef)(),u=Object(a.useCallback)((function(e){if(e){var a=!1===n,r=e.target?Array.from(e.target.files):e.files,c=o?r.filter(o):r;a&&c.length>1&&(c=c.slice(0,1)),t(c)}}),[t,n,o]),d=Object(a.useCallback)((function(){s.current.value=null}),[s]);return r.a.createElement(U.a,Object.assign({component:"label"},i),c,r.a.createElement("input",{type:"file",ref:s,className:l.fileInput,onClick:d,onChange:u,multiple:!1!==n}))},pn=Object(Je.a)((function(e){return{item:function(t){return{minWidth:t-e.spacing(4),textAlign:"center"}}}})),mn=function(e){var t=Object(a.useState)(0),n=Object(s.a)(t,2),c=n[0],o=n[1],i=pn(c),l=Object(a.useRef)();Object(a.useEffect)((function(){l.current&&o(l.current.clientWidth)}),[]);var u=r.a.useState(null),d=Object(s.a)(u,2),p=d[0],m=d[1],f=Object(a.useCallback)((function(e){m(e.currentTarget)}),[]),b=Object(a.useCallback)((function(){m(null)}),[]),v=Object(a.useCallback)((function(t){return function(){e.handleClick(t),b()}}),[e,b]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{ref:l},r.a.createElement(U.a,{fullWidth:!0,variant:"contained","aria-haspopup":"true",onClick:f,"aria-controls":"mask-menu",disabled:e.disabled},"Select Masks")),r.a.createElement(F.a,{id:"mask-menu",keepMounted:!0,anchorEl:p,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},onClose:b,open:Boolean(p),container:e.containerRef.current||null},Array.from({length:3}).map((function(e,t){return r.a.createElement(B.a,{key:t,button:!0,onClick:v("set".concat(t+1,".zip"))},r.a.createElement("span",{className:i.item},"Game ",t+1))}))))},fn=function(e){var t=k(),n=Object(a.useState)(Bt),r=Object(s.a)(n,2),c=r[0],o=r[1],i=Nt({setLapTimeInfo:o}),l=_t({setLapTimeInfo:o}),u=Object(a.useState)(null),d=Object(s.a)(u,2),p=d[0],m=d[1];Object(a.useEffect)((function(){!e.looping&&p&&m(null)}),[e.looping,p]);var f=Object(a.useCallback)(Object(j.a)(O.a.mark((function t(){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.looping?(e.stop(),i.reset()):(e.start(i.handleLoop),m("play"));case 1:case"end":return t.stop()}}),t)}))),[e,i]),b=Object(a.useCallback)(Object(j.a)(O.a.mark((function t(){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.looping){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,i.zip.handleLoadRandomMaskSet();case 4:f();case 5:case"end":return t.stop()}}),t)}))),[f,e.looping,i.zip]),v=Object(a.useCallback)((function(){e.looping?(e.stop(),i.reset()):(e.start(l.handleLoop()),m("capture"))}),[e,l,i]),g=Object(a.useCallback)(Object(j.a)(O.a.mark((function n(){var a;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.looping){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,Promise.all(l.masks.map((function(e){var n=e.overlay;return t.dataUriToImageData(n)})));case 4:a=n.sent,i.setMasks(a),f();case 7:case"end":return n.stop()}}),n)}))),[l.masks,i,t,f,e.looping]);return Object(a.useMemo)((function(){return{name:"practice",loopType:p,simpleGame:i,lapTimeInfo:c,captureMasks:l,handleClickGame:f,handleStartRandomGame:b,handlePlayCapturedMasks:g,handleClickCaptureMasks:v}}),[p,i,c,l,f,b,g,v])},bn=Object(Je.a)((function(e){return{root:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},scrollContainer:{position:"absolute",top:0,left:0,bottom:0,right:-17,overflowY:"scroll",padding:e.spacing(1),height:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},overlay:{background:"rgba(255,255,255,0.5)"},rootTop:{justifyContent:"flex-start"},rootApart:{justifyContent:"space-between"},optionsTop:{justifyContent:"center",alignItems:"center",flexDirection:"row",width:"100%",paddingLeft:e.spacing(10),paddingRight:e.spacing(10)},captures:{width:"100%","& > div":{marginTop:e.spacing(1)}},progress:{position:"absolute",top:e.spacing(1),left:e.spacing(8),right:e.spacing(8)}}})),vn=function(e){var t,n,c,o=bn(),i=ea(),l=k(),s=Object(a.useRef)(),u=ta(fn),d=u.loopType,p=u.lapTimeInfo,m=u.simpleGame,f=u.captureMasks,b=u.handleClickGame,v=u.handleStartRandomGame,g=u.handleClickCaptureMasks,h=i.loop,O=p.color,j=Object(a.useMemo)((function(){return[{props:{key:"play/stop",onClick:b,disabled:!h.ready||!h.looping&&!m.ready,children:h.looping?"Stop":"Play"}},{props:{key:"playRandom",color:"secondary",onClick:v,disabled:!h.ready||h.looping,children:"Play Random"}},{props:{containerRef:s,key:"chooseMasks",disabled:!h.ready||h.looping,handleClick:m.zip.handleLoadPreparedMasks},Component:mn,visible:!h.looping},{props:{key:"loadMasks",variant:"contained",onChange:m.zip.handleZipInputChange,disabled:!h.ready||h.looping||m.zip.loading,children:m.loading?"Loading...":"Load Masks"},Component:dn,visible:!h.looping},{props:{key:"captureMasks",onClick:g,disabled:!h.ready||h.looping,children:"Capture Masks",color:"default"},visible:!h.looping}]}),[h.ready,h.looping,b,m.ready,m.loading,v,m.zip.loading,g,m.zip.handleZipInputChange,m.zip.handleLoadPreparedMasks]);return r.a.createElement("div",{className:o.root},r.a.createElement("div",{className:ae()(o.scrollContainer,(c={},Object(x.a)(c,o.overlay,!h.looping),Object(x.a)(c,o.rootTop,!!h.looping),Object(x.a)(c,o.rootApart,!(!(null===(t=m.scores)||void 0===t?void 0:t.length)&&!(null===(n=f.masks)||void 0===n?void 0:n.length))&&l.isFullScreen),c))},r.a.createElement("div",{className:ae()(Object(x.a)({},o.optionsTop,!!h.looping)),ref:s},h.looping?r.a.createElement(on,{offset:70,buttons:[{props:{key:"stop",onClick:b,children:"Stop"}}]}):r.a.createElement(on,{buttons:j}),h.looping&&"play"===d&&r.a.createElement("div",{className:o.progress},r.a.createElement(Ot,{color:O,completed:p.percentRemaining}))),l.isFullScreen&&!h.looping&&r.a.createElement(gt,null)))},gn=n(294),hn=n.n(gn),On=n(295),jn=n.n(On),yn=Object(g.a)((function(e){return{root:{height:"100%",display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center"},transition:{textAlign:"center"},header:{marginBottom:e.spacing(2)}}})),kn=(je={},Object(x.a)(je,Re.players.SINGLE_PLAYER,hn.a),Object(x.a)(je,Re.players.MULTIPLAYER,jn.a),je),En=function(e){var t=yn(),n=Object(a.useCallback)((function(t){var n=t.currentTarget.name;e.setPlayerMode(n)}),[e]),c=Object(a.useMemo)((function(){return Pe.players.map((function(e){return{props:{key:e,name:e,children:e,onClick:n,disabled:!!Ae[e],Icon:kn[e]}}}))}),[n]);return r.a.createElement("div",{className:t.root},r.a.createElement(on,{label:"Select Players",buttons:c,layout:"h"}))},Cn=function(e){var t=Nt(),n=Object(a.useRef)(!1),r=Object(a.useMemo)((function(){var n=t.scores.length&&!e.looping?t.scores.reduce((function(e,t){return e+t.score}),0):0,a=+n.toFixed(1)/t.scores.length;return"You finished Time Attack in ".concat(n.toFixed(1),"\n      seconds, averaging ").concat(a.toFixed(1)," seconds per pose!")}),[t,e]);Object(a.useEffect)((function(){n.current||(n.current=!0,t.zip.handleLoadPreparedMasks("adam_custom_mask_stuff.zip"))}),[t]);var c=Object(a.useCallback)(Object(j.a)(O.a.mark((function n(){return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.looping?(e.stop(),t.reset()):e.start(t.handleTimeAttackLoop);case 1:case"end":return n.stop()}}),n)}))),[e,t]);return Object(a.useMemo)((function(){return{name:"time attack",simpleGame:t,resultsText:r,handleClickGame:c}}),[t,r,c])},wn=Object(Je.a)((function(e){return{root:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},scrollContainer:{position:"absolute",top:0,left:0,bottom:0,right:-17,overflowY:"scroll",padding:e.spacing(1),height:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},overlay:{background:"rgba(255,255,255,0.5)"},optionsTop:{justifyContent:"center",alignItems:"center",flexDirection:"row",width:"100%",paddingLeft:e.spacing(10),paddingRight:e.spacing(10)},screen:{textAlign:"center","& > button":{marginTop:e.spacing(2)}}}})),xn=function(e){var t,n,a=wn(),c=ea(),o=k(),i=ta(Cn),l=i.simpleGame,s=i.handleClickGame,u=c.loop;return r.a.createElement("div",{className:a.root},r.a.createElement("div",{className:ae()(a.scrollContainer,Object(x.a)({},a.overlay,!u.looping))},r.a.createElement("div",{className:ae()(a.screen,Object(x.a)({},a.optionsTop,!!u.looping))},!u.looping&&r.a.createElement(Xt,{primaryText:"Time Attack",secondaryText:(null===(t=l.scores)||void 0===t?void 0:t.length)?"Play Again?":"Match the poses as quickly as you can.",Icon:(null===(n=l.scores)||void 0===n?void 0:n.length)?"replay":"play",iconProps:{color:"secondary",loading:!u.ready,onClick:s},middleContent:o.isFullScreen&&r.a.createElement(gt,{hideClose:!0}),helpContent:["Match each pose as quickly as possible","Your score is based on your total time, and the average time per pose.","Hop to it!"]}))))},Sn=n(616),In=n(617),Tn=n(623),Ln=n(575),Mn=n(171),Rn=n.n(Mn),An=n(172),Pn=n.n(An),Dn=function(e){var t=k(),n=Object(a.useState)(Bt),r=Object(s.a)(n,2),c=r[0],o=r[1],i=Nt({setLapTimeInfo:o}),l=_t({maxMasks:5,setLapTimeInfo:o}),u=Object(a.useMemo)((function(){return i.multiplayerScores.map((function(t){return t.length&&!e.looping?t.reduce((function(e,t){return e+t.score}),0):0}))}),[i,e]),d=Object(a.useMemo)((function(){return u.map((function(e,t){return"Player ".concat(t?"Two":"One"," scored a total of ").concat(e," points")}))}),[u]),p=Object(a.useState)([[],[]]),m=Object(s.a)(p,2),f=m[0],b=m[1],v=Object(a.useState)(0),g=Object(s.a)(v,2),h=g[0],y=g[1],E=Object(a.useCallback)((function(){y((function(e){return e+1}))}),[]),C=Object(a.useCallback)((function(){e.looping?e.stop():(E(),e.start(l.handleLoop(Object(j.a)(O.a.mark((function e(){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(l.getMasks().map((function(e){var n=e.overlay;return t.dataUriToImageData(n)})));case 2:n=e.sent,0===h?b([n,[]]):1===h&&b((function(e){return[Object(jt.a)(e[0]),n]})),l.removeAllMasks();case 5:case"end":return e.stop()}}),e)}))))))}),[e,l,h,t,E]),w=Object(a.useCallback)((function(){var t=2===h?1:0,n=2===h?0:1;i.setMasks(f[t]),e.start(i.handleMultiplayerLoop(n)),E()}),[e,f,i,h,E]),x=Object(a.useCallback)((function(){y(0),i.clearScores()}),[i]),S=Object(a.useCallback)((function(){e.looping||(h<2?C():h<4?w():x())}),[e.looping,w,C,x,h]);return Object(a.useMemo)((function(){return{name:"local",simpleGame:i,handleClick:S,lapTimeInfo:c,captureMasks:l,setupProgress:h,multiplayerResultsText:d,multiplayerScoreSums:u,NUM_MASKS:5}}),[i,c,l,h,S,d,u])},Nn=Object(Je.a)((function(e){return{root:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},scrollContainer:{position:"absolute",top:0,left:0,bottom:0,right:-17,overflowY:"scroll",padding:e.spacing(1),height:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},overlay:{background:"rgba(255,255,255,0.5)"},rootTop:{justifyContent:"flex-start"},rootApart:{justifyContent:"space-between"},optionsTop:{justifyContent:"center",alignItems:"center",flexDirection:"row",width:"100%",paddingLeft:e.spacing(10),paddingRight:e.spacing(10)},progress:{position:"absolute",top:e.spacing(1),left:e.spacing(8),right:e.spacing(8)},container:{textAlign:"center"},stepper:{background:"transparent",marginBottom:e.spacing(2)}}})),Fn=Object(Je.a)((function(e){return{root:{backgroundColor:"#ccc",zIndex:1,color:"#fff",width:50,height:50,display:"flex",borderRadius:"50%",justifyContent:"center",alignItems:"center"},active:{backgroundImage:"linear-gradient( 136deg, ".concat(e.palette.secondary.light," 0%, ").concat(e.palette.secondary.main," 50%, ").concat(e.palette.secondary.dark," 100%)"),boxShadow:"0 4px 10px 0 rgba(0,0,0,.25)"},completed:{backgroundImage:"linear-gradient( 136deg, ".concat(e.palette.primary.light," 0%, ").concat(e.palette.primary.main," 50%, ").concat(e.palette.primary.dark," 100%)")}}}));function Un(e){var t,n=Fn(),a=e.active,c=e.completed,o={1:r.a.createElement(Rn.a,null),2:r.a.createElement(Rn.a,null),3:r.a.createElement(Pn.a,null),4:r.a.createElement(Pn.a,null)};return r.a.createElement("div",{className:ae()(n.root,(t={},Object(x.a)(t,n.active,a),Object(x.a)(t,n.completed,c),t))},o[String(e.icon)])}var _n,Bn,zn,Gn=["Player One Capture","Player Two Capture","Player One Play","Player Two Play"],Yn=function(e){var t,n=ea(),c=ta(Dn),o=k(),i=Object(s.a)([["One","Two"],["Two","One"]][c.setupProgress%2],2),l=i[0],u=i[1],d=c.setupProgress<2?"Player ".concat(l,", get ready to capture ").concat(c.NUM_MASKS," poses."):"Player ".concat(l,", get ready to play!"),p=c.setupProgress<2?"Player ".concat(u,", please leave the room."):"Good luck!",m=c.setupProgress>=4,f=Object(a.useMemo)((function(){return m?c.multiplayerScoreSums[0]>c.multiplayerScoreSums[1]?"Player One wins!":c.multiplayerScoreSums[0]<c.multiplayerScoreSums[1]?"Player Two wins!":"It's a tie!":""}),[c.multiplayerScoreSums,m]),b=Nn(m);return r.a.createElement("div",{className:b.root},r.a.createElement("div",{className:ae()(b.scrollContainer,(t={},Object(x.a)(t,b.overlay,!n.loop.looping),Object(x.a)(t,b.rootTop,!1),Object(x.a)(t,b.rootApart,!1),t))},r.a.createElement("div",{className:ae()(b.container,Object(x.a)({},b.optionsTop,!!n.loop.looping))},n.loop.looping?r.a.createElement("div",{className:b.progress},r.a.createElement(Ot,{color:c.lapTimeInfo.color,completed:c.lapTimeInfo.percentRemaining})):r.a.createElement(Xt,{headerContent:!m&&r.a.createElement(Sn.a,{className:b.stepper,alternativeLabel:!0,activeStep:c.setupProgress,connector:r.a.createElement(Ln.a,null)},Gn.map((function(e){return r.a.createElement(In.a,{key:e},r.a.createElement(Tn.a,{StepIconComponent:Un},e))}))),primaryText:m?f:d,middleContent:c.setupProgress>=3&&o.isFullScreen&&!n.loop.looping&&r.a.createElement(en,{isFullScreen:o.isFullScreen}),secondaryText:m?"Play again?":p,iconProps:{color:m?"primary":"secondary",loading:!n.loop.ready,onClick:c.handleClick},Icon:m?"replay":"play",helpContent:!m&&["In this game mode two players will compete head to head.","Each player will take turns capturing funky poses for their opponent to try and match.","The player who does the best job matching their opponent's poses will win."]}))))},Vn=Object(x.a)({},Re.screen.PLAY,(zn={},Object(x.a)(zn,Re.players.SINGLE_PLAYER,(_n={},Object(x.a)(_n,Re.mode[Re.players.SINGLE_PLAYER].PRACTICE,vn),Object(x.a)(_n,Re.mode[Re.players.SINGLE_PLAYER].SURVIVAL,Zt),Object(x.a)(_n,Re.mode[Re.players.SINGLE_PLAYER].TIME_ATTACK,xn),_n)),Object(x.a)(zn,Re.players.MULTIPLAYER,(Bn={},Object(x.a)(Bn,Re.mode[Re.players.MULTIPLAYER].LOCAL,Yn),Object(x.a)(Bn,Re.mode[Re.players.MULTIPLAYER].REMOTE,(function(){return"REMOTE Content"})),Bn)),zn)),Wn=function(e){var t,n,a=e.screen.state,c=a.screen,o=a.mode,i=a.players;if(c===Re.screen.DEFAULT)return r.a.createElement(En,{setPlayerMode:e.screen.handlers.setPlayerMode});if(o===Re.mode.DEFAULT)return r.a.createElement(sn,{screen:e.screen});var l=(null===(t=Vn[c])||void 0===t||null===(n=t[i])||void 0===n?void 0:n[o])||Ze;return r.a.createElement(l,null)},qn=function(e,t){switch(t.type){case Te:return Object(S.a)(Object(S.a)({},e),{},{mode:t.value});case Ie:return Object(S.a)(Object(S.a)({},e),{},{screen:Re.screen.PLAY,players:t.value});case Me:return De;case Le:var n=Object(S.a)({},e);if(e.mode)n.mode=Re.mode.DEFAULT;else{if(e.screen===Re.screen.DEFAULT)return e;n.screen=Re.screen.DEFAULT,n.players=Re.players.DEFAULT}return n;default:throw new Error("Invalid action: ".concat(t.type))}},Hn=n(296),Xn=n.n(Hn)()(),Kn=Object(a.createContext)(),$n=function(e){var t=e.children,n=function(){var e=k(),t=Object(a.useRef)(),n=Object(a.useRef)(),r=Object(a.useState)(!1),c=Object(s.a)(r,2),o=c[0],i=c[1],l=Object(a.useState)(!1),u=Object(s.a)(l,2),d=u[0],p=u[1];Object(a.useEffect)((function(){!t.current&&e.ready&&(t.current=!0,Xn.load().then((function(){console.log("BodyPix loaded"),i(!0)})).catch(console.error))}),[e]);var m=Object(a.useCallback)(Object(j.a)(O.a.mark((function t(){var n;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=2;break}throw new Error('Please wait for the model to load before calling "predict"');case 2:return t.next=4,Xn.predict(e.getVideoAsImageData());case 4:return n=t.sent,t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)}))),[o,e]);return Object(a.useEffect)((function(){!o||n.current||d||(n.current=!0,m().then((function(){p(!0)})))}),[m,o,d]),d?m:null}();return r.a.createElement(Kn.Provider,{value:n},t)},Zn=function(){var e=k(),t=function(){var e=Object(a.useContext)(Kn);if(void 0===e)throw new Error("useBodyPix must be used within a BodyPixProvider");return e}(),n=t&&e.ready,r=function(){var e=Object(a.useRef)(),t=Object(a.useRef)(),n=Object(a.useRef)(),r=Object(a.useRef)(),c=Object(a.useRef)(),o=Object(a.useCallback)((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t.current=a,e.current=a,r.current=0,n.current=0,c.current=0}),[]),i=Object(a.useCallback)((function(){c.current=0}),[]),l=Object(a.useCallback)((function(a){var l=!1;t.current||(l=!0,o(a));var s=a-e.current;c.current+=s;var u=0,d=0;n.current++&&(u=1e3/s,d=r.current/n.current,r.current+=u);var p=a-t.current;return e.current=a,{first:l,timestamp:a,fps:u,avgFps:d,elapsed:p,frames:n.current,lapTime:c.current,resetLapTime:i}}),[o,i]);return Object(a.useMemo)((function(){return{update:l,reset:o}}),[l,o])}(),c=function(){var e=Object(a.useRef)(),t=we().handlers.speech,n=Object(a.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.onBeforeStartLap,a=t.onLap,r=t.onEnd,c=t.maxLaps,o=t.setLapTimeInfo,i=t.lapDuration,l=void 0===i?3e3:i,s=t.postLapDelay,u=void 0===s?1e3:s,d=t.announceSeconds,p=void 0===d||d;a&&!e.current&&(e.current={onBeforeStartLap:n,onBeforeComplete:!1,onBeforeStarted:!1,onEndCalled:!1,onLap:a,onEnd:r,maxLaps:c,numLaps:0,lapDuration:l,postLapDelay:u,setLapTimeInfo:o,announceSeconds:p},o&&e.current.setLapTimeInfo(Bt))}),[]),r=Object(a.useCallback)(function(){var n=Object(j.a)(O.a.mark((function n(a){var r,c,o,i,l,s,u,d,p,m,f;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=a.time,c=a.webcam,o=a.predict,i=a.stop,!e.current){n.next=40;break}if(!e.current.onBeforeStartLap||e.current.onBeforeComplete){n.next=13;break}if(!e.current.onBeforeStarted){n.next=7;break}return n.abrupt("return");case 7:return e.current.onBeforeStarted=!0,n.next=10,e.current.onBeforeStartLap({time:r,webcam:c,predict:o,stop:i});case 10:return e.current.onBeforeComplete=!0,r.resetLapTime(),n.abrupt("return");case 13:if(!e.current.maxLaps||e.current.numLaps!==e.current.maxLaps){n.next=26;break}if(!e.current.onEnd){n.next=24;break}if(e.current.onEndCalled){n.next=21;break}return e.current.onEndCalled=!0,n.next=19,e.current.onEnd({time:r,webcam:c,predict:o,stop:i});case 19:return e.current=null,n.abrupt("return",i());case 21:return n.abrupt("return");case 24:return e.current=null,n.abrupt("return",i());case 26:if(l=Math.floor(r.lapTime/100)/10,s=+Math.max(e.current.lapDuration/1e3-l,0).toFixed(1),e.current.setLapTimeInfo&&(u=Math.min(Number(s)/e.current.lapDuration*1e5,100),d=100-u,p=nt(u),m=s.toFixed(1),f={percent:d,percentRemaining:u,color:p,secondsRemaining:m},e.current.setLapTimeInfo(f)),s&&e.current.announceSeconds&&e.current.lastSpeech!==s&&parseInt(s,10)===Number(s)&&(e.current.lastSpeech=s,t.say("".concat(s))),!(r.lapTime>=e.current.lapDuration)||e.current.handlerCalled){n.next=39;break}return e.current.numLaps++,e.current.handlerCalled=!0,e.current.handlerResolved=!1,n.next=36,e.current.onLap({time:r,webcam:c,predict:o,stop:i,lapNum:e.current.numLaps});case 36:e.current.handlerResolved=!0,n.next=40;break;case 39:r.lapTime>=e.current.lapDuration+e.current.postLapDelay&&e.current.handlerResolved&&(r.resetLapTime(),e.current.handlerCalled=!1,e.current.handlerResolved=!1);case 40:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[t]),c=Object(a.useCallback)((function(){e.current=null}),[]);return Object(a.useMemo)((function(){return{clear:c,useTimer:n,handleLap:r,timerRef:e}}),[c,n,r,e])}(),o=Object(a.useRef)(),i=Object(a.useRef)(),l=Object(a.useState)(!1),u=Object(s.a)(l,2),d=u[0],p=u[1],m=Object(a.useCallback)((function(){c.clear(),r.reset(),o.current=!0,p(!0)}),[r,c]),f=Object(a.useCallback)((function(){o.current=!1,p(!1)}),[]),b=Object(a.useCallback)(function(){var n=Object(j.a)(O.a.mark((function n(a){var l,s,u;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l=r.update(a),s={time:l,webcam:e,predict:t,timerRef:c.timerRef,useTimer:c.useTimer,stop:f},n.next=4,i.current(s);case 4:u=n.sent,c.handleLap(s),o.current?requestAnimationFrame(b):(f(),i.current=null,e.clearCanvas(),u&&u());case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[e,t,c,r,f]),v=Object(a.useCallback)(function(){var e=Object(j.a)(O.a.mark((function e(a){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}throw new Error("The loop is not ready");case 4:if(!o.current){e.next=8;break}throw new Error("The loop is already running");case 8:if(t){e.next=12;break}throw new Error("Please wait for BodyPix to load...");case 12:if(a){e.next=14;break}throw new Error("A loop handler is required when calling loop.start");case 14:return i.current=a,m(),e.abrupt("return",requestAnimationFrame(b));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[b,t,m,n]);return Object(a.useMemo)((function(){return{start:v,looping:d,ready:n,stop:f}}),[v,d,f,n])},Jn=function(){var e=Zn(),t=Object(a.useState)(null),n=Object(s.a)(t,2),r=n[0],c=n[1],o=function(){var e=Object(a.useReducer)(qn,De),t=Object(s.a)(e,2),n=t[0],r=t[1],c=Object(a.useCallback)((function(e){if(!Pe.screen.includes(e))throw new Error("Unknown screen: ".concat(e));r({type:Se,value:e})}),[]),o=Object(a.useCallback)((function(e){if(![].concat(Object(jt.a)(Pe.mode[Re.players.SINGLE_PLAYER]),Object(jt.a)(Pe.mode[Re.players.MULTIPLAYER])).includes(e))throw new Error("Unknown gameMode: ".concat(e));r({type:Te,value:e})}),[]),i=Object(a.useCallback)((function(e){if(!Pe.players.includes(e))throw new Error("Unknown playerMode: ".concat(e));e===Re.players.MULTIPLAYER&&o(Re.mode[Re.players.MULTIPLAYER].LOCAL),r({type:Ie,value:e})}),[o]),l=Object(a.useCallback)((function(){r({type:Me})}),[]),u=Object(a.useCallback)((function(){r({type:Le})}),[]);return[n,Object(a.useMemo)((function(){return{setScreen:c,resetState:l,setGameMode:o,reverseState:u,setPlayerMode:i}}),[c,l,o,u,i])]}(),i=Object(s.a)(o,2),l=i[0],u=i[1],d=Object(a.useState)(!0),p=Object(s.a)(d,2),m=p[0],f=p[1],b=Object(a.useRef)(),v=Object(a.useCallback)((function(){f(!0)}),[]);return Object(a.useEffect)((function(){b.current||(!!localStorage.getItem("__TUTORIAL_COMPLETE__")||l.screen===Re.screen.DEFAULT&&(b.current=!0,localStorage.setItem("__TUTORIAL_COMPLETE__",!0),f(!1)))}),[l]),Object(a.useEffect)((function(){l.screen!==Re.screen.DEFAULT&&l.mode!==Re.mode.DEFAULT||!r||c(null)}),[l,r]),Object(a.useEffect)((function(){l.screen!==Re.screen.DEFAULT&&l.mode!==Re.mode.DEFAULT||!e.looping||e.stop()}),[l,e]),Object(a.useMemo)((function(){return{screen:{state:l,handlers:u},mode:r,loop:e,setMode:c,tutorial:{completed:m,markTutorialCompleted:v}}}),[l,u,r,e,m,v])},Qn=Object(a.createContext)(),ea=function(){var e=Object(a.useContext)(Qn);if(!e)throw new Error("useGame must be called from inside the <Game> component.");return e},ta=function(e){var t=ea(),n=t.loop,r=t.setMode,c=e(n);return Object(a.useEffect)((function(){r(c)}),[c,r]),c},na=Object(a.memo)((function(e){e.webcam;var t=Jn();return r.a.createElement(Qn.Provider,{value:t},r.a.createElement(We,{tutorial:t.tutorial,mode:t.screen.state.mode,screen:t.screen.state.screen,players:t.screen.state.players,goHome:t.screen.handlers.resetState,goBack:t.screen.handlers.reverseState}),r.a.createElement($e,{screenState:t.screen.state}),r.a.createElement(te,{overlay:!t.screen.state.mode},r.a.createElement(Wn,{screen:t.screen})),r.a.createElement(an,{screen:t.screen}))})),aa=function(){return r.a.createElement("div",null,"Sorry, but this game requires a webcam. Please plug in a webcam and refresh the page.")},ra=Object(g.a)((function(e){return{root:{maxWidth:1100,margin:"0 auto ".concat(e.spacing(2),"px")}}})),ca=Object(a.memo)((function(e){var t=k(),n=t.currentDeviceId,c=t.hasVideo,o=t.cameras,i=t.autoStartDeviceId,l=Object(a.useRef)();Object(a.useEffect)((function(){c&&o.length&&(n||i)&&!l.current&&(l.current=!0,t.start().catch(console.error))}),[c,o,n,i,t]);var s=ra();return r.a.createElement("main",{className:s.root},c?r.a.createElement(na,{webcam:t}):r.a.createElement(aa,null))})),oa=Object(m.a)({palette:{primary:v.a}});var ia=function(){var e=Object(a.useState)(!1),t=Object(s.a)(e,2),n=t[0],c=t[1],o=Object(a.useRef)();return Object(a.useEffect)((function(){var e=setInterval((function(){window.cvReady&&(c(!0),clearInterval(e))}),200);return function(){clearInterval(e)}}),[]),Object(a.useEffect)((function(){o.current||(o.current=!0,d.a.init({selector:".background"}))})),r.a.createElement(f.a,{theme:oa},r.a.createElement(C,null,r.a.createElement($n,null,r.a.createElement(xe,null,r.a.createElement(Dt,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,null),r.a.createElement(ca,{cvReady:n})))))))};o.a.render(r.a.createElement(ia,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[308,1,2]]]);
//# sourceMappingURL=main.c496117e.chunk.js.map